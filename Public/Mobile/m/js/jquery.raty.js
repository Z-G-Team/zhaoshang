/*
 * jQuery Raty - A Star Rating Plugin
 *
 * The MIT License
 *
 * @author  : Washington Botelho
 * @doc     : http://wbotelhos.com/raty
 * @version : 2.7.0
 *
 */
(function(b){"use strict";var a={init:function(c){return this.each(function(){this.self=b(this);a.destroy.call(this.self);this.opt=b.extend(true,{},b.fn.raty.defaults,c);a._adjustCallback.call(this);a._adjustNumber.call(this);a._adjustHints.call(this);this.opt.score=a._adjustedScore.call(this,this.opt.score);this.opt.starType!=="img"&&a._adjustStarType.call(this);a._adjustPath.call(this);a._createStars.call(this);this.opt.cancel&&a._createCancel.call(this);this.opt.precision&&a._adjustPrecision.call(this);a._createScore.call(this);a._apply.call(this,this.opt.score);a._setTitle.call(this,this.opt.score);a._target.call(this,this.opt.score);if(this.opt.readOnly)a._lock.call(this);else{this.style.cursor="pointer";a._binds.call(this)}})},_adjustCallback:function(){for(var b=["number","readOnly","score","scoreName","target","path"],a=0;a<b.length;a++)if(typeof this.opt[b[a]]==="function")this.opt[b[a]]=this.opt[b[a]].call(this)},_adjustedScore:function(b){return!b?b:a._between(b,0,this.opt.number)},_adjustHints:function(){if(!this.opt.hints)this.opt.hints=[];if(!this.opt.halfShow&&!this.opt.half)return;for(var f=this.opt.precision?10:2,b=0;b<this.opt.number;b++){var a=this.opt.hints[b];if(Object.prototype.toString.call(a)!=="[object Array]")a=[a];this.opt.hints[b]=[];for(var c=0;c<f;c++){var e=a[c],d=a[a.length-1];if(d===undefined)d=null;this.opt.hints[b][c]=e===undefined?d:e}}},_adjustNumber:function(){this.opt.number=a._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function(){this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.charAt(this.opt.path.length-1)!=="/")this.opt.path+="/"},_adjustPrecision:function(){this.opt.half=true},_adjustStarType:function(){var b=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var a=0;a<b.length;a++)this.opt[b[a]]=this.opt[b[a]].replace(".","-")},_apply:function(b){a._fill.call(this,b);if(b){b>0&&this.score.val(b);a._roundStars.call(this,b)}},_between:function(a,c,b){return Math.min(Math.max(parseFloat(a),c),b)},_binds:function(){if(this.cancel){a._bindOverCancel.call(this);a._bindClickCancel.call(this);a._bindOutCancel.call(this)}a._bindOver.call(this);a._bindClick.call(this);a._bindOut.call(this)},_bindClick:function(){var c=this;c.stars.on("click.raty",function(f){var e=true,d=c.opt.half||c.opt.precision?c.self.data("score"):this.alt||b(this).data("alt");if(c.opt.click)e=c.opt.click.call(c,+d,f);if(e||e===undefined){if(c.opt.half&&!c.opt.precision)d=a._roundHalfScore.call(c,d);a._apply.call(c,d)}})},_bindClickCancel:function(){var a=this;a.cancel.on("click.raty",function(b){a.score.removeAttr("value");a.opt.click&&a.opt.click.call(a,null,b)})},_bindOut:function(){var b=this;b.self.on("mouseleave.raty",function(d){var c=+b.score.val()||undefined;a._apply.call(b,c);a._target.call(b,c,d);a._resetTitle.call(b);b.opt.mouseout&&b.opt.mouseout.call(b,c,d)})},_bindOutCancel:function(){var b=this;b.cancel.on("mouseleave.raty",function(e){var c=b.opt.cancelOff;if(b.opt.starType!=="img")c=b.opt.cancelClass+" "+c;a._setIcon.call(b,this,c);if(b.opt.mouseout){var d=+b.score.val()||undefined;b.opt.mouseout.call(b,d,e)}})},_bindOver:function(){var b=this,c=b.opt.half?"mousemove.raty":"mouseover.raty";b.stars.on(c,function(d){var c=a._getScoreByPosition.call(b,d,this);a._fill.call(b,c);if(b.opt.half){a._roundStars.call(b,c,d);a._setTitle.call(b,c,d);b.self.data("score",c)}a._target.call(b,c,d);b.opt.mouseover&&b.opt.mouseover.call(b,c,d)})},_bindOverCancel:function(){var b=this;b.cancel.on("mouseover.raty",function(e){var d=b.opt.path+b.opt.starOff,c=b.opt.cancelOn;if(b.opt.starType==="img")b.stars.attr("src",d);else{c=b.opt.cancelClass+" "+c;b.stars.attr("class",d)}a._setIcon.call(b,this,c);a._target.call(b,null,e);b.opt.mouseover&&b.opt.mouseover.call(b,null)})},_buildScoreField:function(){return b("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function(){var c=this.opt.path+this.opt.cancelOff,a=b("<"+this.opt.starType+" />",{title:this.opt.cancelHint,"class":this.opt.cancelClass});if(this.opt.starType==="img")a.attr({src:c,alt:"x"});else a.attr("data-alt","x").addClass(c);if(this.opt.cancelPlace==="left")this.self.prepend("&#160;").prepend(a);else this.self.append("&#160;").append(a);this.cancel=a},_createScore:function(){var c=b(this.opt.targetScore);this.score=c.length?c:a._buildScoreField.call(this)},_createStars:function(){for(var c=1;c<=this.opt.number;c++){var e=a._nameForIndex.call(this,c),d={alt:c,src:this.opt.path+this.opt[e]};if(this.opt.starType!=="img")d={"data-alt":c,"class":d.src};d.title=a._getHint.call(this,c);b("<"+this.opt.starType+" />",d).appendTo(this);this.opt.space&&this.self.append(c<this.opt.number?"&#160;":"")}this.stars=this.self.children(this.opt.starType)},_error:function(a){b(this).text(a);b.error(a)},_fill:function(h){for(var e=0,b=1;b<=this.stars.length;b++){var c,g=this.stars[b-1],f=a._turnOn.call(this,b,h);if(this.opt.iconRange&&this.opt.iconRange.length>e){var d=this.opt.iconRange[e];c=a._getRangeIcon.call(this,d,f);b<=d.range&&a._setIcon.call(this,g,c);if(b===d.range)e++}else{c=this.opt[f?"starOn":"starOff"];a._setIcon.call(this,g,c)}}},_getFirstDecimal:function(c){var a=c.toString().split(".")[1],b=0;if(a){b=parseInt(a.charAt(0),10);if(a.slice(1,5)==="9999")b++}return b},_getRangeIcon:function(a,b){return b?a.on||this.opt.starOn:a.off||this.opt.starOff},_getScoreByPosition:function(g,d){var c=parseInt(d.alt||d.getAttribute("data-alt"),10);if(this.opt.half){var f=a._getWidth.call(this),e=parseFloat((g.pageX-b(d).offset().left)/f);c=c-1+e}return c},_getHint:function(c,h){if(c!==0&&!c)return this.opt.noRatedMsg;var b=a._getFirstDecimal.call(this,c),g=Math.ceil(c),e=this.opt.hints[(g||1)-1],d=e,f=!h||this.move;if(this.opt.precision){if(f)b=b===0?9:b-1;d=e[b]}else if(this.opt.halfShow||this.opt.half){b=f&&b===0?1:b>5?1:0;d=e[b]}return d===""?"":d||c},_getWidth:function(){var b=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));!b&&a._error.call(this,"Could not get the icon width!");return b},_lock:function(){var b=a._getHint.call(this,this.score.val());this.style.cursor="";this.title=b;this.score.prop("readonly",true);this.stars.prop("title",b);this.cancel&&this.cancel.hide();this.self.data("readonly",true)},_nameForIndex:function(a){return this.opt.score&&this.opt.score>=a?"starOn":"starOff"},_resetTitle:function(){for(var b=0;b<this.opt.number;b++)this.stars[b].title=a._getHint.call(this,b+1)},_roundHalfScore:function(c){var d=parseInt(c,10),b=a._getFirstDecimal.call(this,c);if(b!==0)b=b>5?1:.5;return d+b},_roundStars:function(d,g){var c=(d%1).toFixed(2),b;if(g||this.move)b=c>.5?"starOn":"starHalf";else if(c>this.opt.round.down){b="starOn";if(this.opt.halfShow&&c<this.opt.round.up)b="starHalf";else if(c<this.opt.round.full)b="starOff"}if(b){var e=this.opt[b],f=this.stars[Math.ceil(d)-1];a._setIcon.call(this,f,e)}},_setIcon:function(b,a){b[this.opt.starType==="img"?"src":"className"]=this.opt.path+a},_setTarget:function(b,a){if(a)a=this.opt.targetFormat.toString().replace("{score}",a);if(b.is(":input"))b.val(a);else b.html(a)},_setTitle:function(b,e){if(b){var c=parseInt(Math.ceil(b),10),d=this.stars[c-1];d.title=a._getHint.call(this,b,e)}},_target:function(c,d){if(this.opt.target){var f=b(this.opt.target);!f.length&&a._error.call(this,"Target selector invalid or missing!");var e=d&&d.type==="mouseover";if(c===undefined)c=this.opt.targetText;else if(c===null)c=e?this.opt.cancelHint:this.opt.targetText;else{if(this.opt.targetType==="hint")c=a._getHint.call(this,c,d);else if(this.opt.precision)c=parseFloat(c).toFixed(1);var g=d&&d.type==="mousemove";if(!e&&!g&&!this.opt.targetKeep)c=this.opt.targetText}a._setTarget.call(this,f,c)}},_turnOn:function(b,a){return this.opt.single?b===a:b<=a},_unlock:function(){this.style.cursor="pointer";this.removeAttribute("title");this.score.removeAttr("readonly");this.self.data("readonly",false);for(var b=0;b<this.opt.number;b++)this.stars[b].title=a._getHint.call(this,b+1);this.cancel&&this.cancel.css("display","")},cancel:function(c){return this.each(function(){var d=b(this);if(d.data("readonly")!==true){a[c?"click":"score"].call(d,null);this.score.removeAttr("value")}})},click:function(c){return this.each(function(){if(b(this).data("readonly")!==true){c=a._adjustedScore.call(this,c);a._apply.call(this,c);this.opt.click&&this.opt.click.call(this,c,b.Event("click"));a._target.call(this,c)}})},destroy:function(){return this.each(function(){var a=b(this),c=a.data("raw");if(c)a.off(".raty").empty().css({cursor:c.style.cursor}).removeData("readonly");else a.data("raw",a.clone()[0])})},getScore:function(){var a=[],b;this.each(function(){b=this.score.val();a.push(b?+b:undefined)});return a.length>1?a:a[0]},move:function(c){return this.each(function(){var d=parseInt(c,10),e=a._getFirstDecimal.call(this,c);if(d>=this.opt.number){d=this.opt.number-1;e=10}var i=a._getWidth.call(this),h=i/10,f=b(this.stars[d]),g=f.offset().left+h*e,j=b.Event("mousemove",{pageX:g});this.move=true;f.trigger(j);this.move=false})},readOnly:function(c){return this.each(function(){var d=b(this);if(d.data("readonly")!==c){if(c){d.off(".raty").children("img").off(".raty");a._lock.call(this)}else{a._binds.call(this);a._unlock.call(this)}d.data("readonly",c)}})},reload:function(){return a.set.call(this,{})},score:function(){var c=b(this);return arguments.length?a.setScore.apply(c,arguments):a.getScore.call(c)},"set":function(a){return this.each(function(){b(this).raty(b.extend({},this.opt,a))})},setScore:function(c){return this.each(function(){if(b(this).data("readonly")!==true){c=a._adjustedScore.call(this,c);a._apply.call(this,c);a._target.call(this,c)}})}};b.fn.raty=function(c){if(a[c])return a[c].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof c==="object"||!c)return a.init.apply(this,arguments);else b.error("Method "+c+" does not exist!")};b.fn.raty.defaults={cancel:false,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["\u975e\u5e38\u4e0d\u6eff\u610f","\u4e0d\u6eff\u610f","\u5c1a\u53ef","\u6eff\u610f","\u975e\u5e38\u6eff\u610f"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:undefined,precision:false,readOnly:false,round:{down:.25,full:.6,up:.76},score:undefined,scoreName:"score",single:false,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:undefined,targetFormat:"{score}",targetKeep:false,targetScore:undefined,targetText:"",targetType:"hint"}})(jQuery)